# esp32_ssd1306_LovyanGFXx4 - ESP32 4連OLEDディスプレイプロジェクト (人感センサ対応版)

## 概要
このプロジェクトは、ESP32開発ボードと4枚のSSD1306 OLEDディスプレイを使用し、LovyanGFXライブラリを介して横長の多機能ディスプレイを構築します。NTPサーバーから取得した正確な時刻、OpenWeatherMap APIから取得した天気予報、計算された月齢、そして**アイドル時のスクリーンセーバーとしてスターフィールド（星空）アニメーション**を視覚的に表示します。

新たに**人感センサ（PIRセンサ）**に対応し、人の気配を検知して自動的に画面を点灯・維持する機能が追加されました。

## 機能
-   **4連OLEDディスプレイ表示**: 128x64ピクセルのSSD1306 OLEDを4枚連結し、合計512x64ピクセルの広大な表示領域を構成します。
-   **デュアルI2Cバス**: 2つのI2Cバスを使用し、各バスに2枚ずつのOLEDを効率的に接続します。
-   **WiFi接続**: 指定されたWiFiネットワークに接続し、インターネット経由で各種情報を取得します。
-   **NTP時刻同期**: NTPサーバーから現在時刻を取得し、日付と時刻を正確に表示します。
-   **月齢表示と動的更新**:
    *   計算した月齢を、数値と月の満ち欠けを模したグラフィックで表示します。
    *   日付が変わったタイミングだけでなく、**月齢の整数値（四捨五入）が変化した際にも即座に表示を更新**します。
-   **天気情報表示**: OpenWeatherMap APIから取得した天気予報（今日と明日）を、天気概況・最高気温・最低気温に分けて分かりやすく表示します。
-   **秒プログレスバー**: 時刻表示画面に、秒の経過を視覚的に示すインジケータを表示します。
-   **スマート省電力とスクリーンセーバー**:
    *   **人感センサ (GPIO 14)**: 1秒おきにセンサの状態をチェックします。人を検知している間、および最後に検知してから設定時間内は通常表示を維持します。
    *   **タッチセンサ (GPIO 33)**: 従来のタッチ操作による復帰・維持も継続して利用可能です。
    *   **自動スクリーンセーバー**: 「タッチ操作」と「人感センサの反応」のいずれも5分間途絶えると、自動で画面をスターフィールドアニメーションに切り替えます。
    *   **自動復帰**: スクリーンセーバー中に「人の接近」または「タッチ」を検知すると、即座に通常表示に復帰します。

## 表示内容の詳細

### 1枚目 (左端)
-   **日付**: `YYYY/MM/DD`形式で表示します。
-   **曜日**: `(月)` `(火)` のように表示します。
-   **月齢**: 計算された月齢の数値を表示し、その隣に月の満ち欠けをグラフィックで描画します（数値変化時に更新）。

### 2枚目
-   **時刻**: `HH:MM`形式で表示します。
-   **秒プログレスバー**: 時刻の下に、秒の経過を示すインジケータが移動します。

### 3枚目
-   **今日の天気**: 天気概況、最高気温、最低気温。

### 4枚目 (右端)
-   **明日の天気**: 天気概況、最高気温、最低気温。

## ハードウェア構成

### OLEDディスプレイ接続
-   SSD1306 OLED x 4枚 (I2Cバス2系統)

### センサ接続
-   **人感センサ (PIR)**: GPIO 14 (Hiで検知)
-   **タッチセンサ**: GPIO 33

### I2Cピンアサイン
-   **I2Cバス1 (0x3C, 0x3D)**: SDA: GPIO 21, SCL: GPIO 22
-   **I2Cバス2 (0x3C, 0x3D)**: SDA: GPIO 17, SCL: GPIO 16

## セットアップ方法

1.  **設定情報の更新**:
    `src/main.cpp` の以下の項目を環境に合わせて書き換えてください。
    -   WiFi SSID / パスワード
    -   OpenWeatherMap APIキー / 都市名
    -   `touchThreshold`: タッチセンサの感度
    -   `displayTimeout`: スクリーンセーバー移行時間（デフォルト10分）

2.  **ビルドと書き込み**:
    PlatformIOを使用してESP32にアップロードしてください。

## 使用ライブラリ
-   `lovyan03/LovyanGFX`
-   `NTPClient`
-   `bblanchon/ArduinoJson`
