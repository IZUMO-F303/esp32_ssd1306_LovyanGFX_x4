[README.md](https://github.com/user-attachments/files/25322592/README.md)
# esp32_ssd1306_LovyanGFXx4 - ESP32 4連OLEDディスプレイプロジェクト
# 動画による解説はこちら
　https://youtu.be/-io6BB13Hwo

## 概要
このプロジェクトは、ESP32開発ボードと4枚のSSD1306 OLEDディスプレイを使用し、LovyanGFXライブラリを介して横長の多機能ディスプレイを構築します。NTPサーバーから取得した正確な時刻、OpenWeatherMap APIから取得した天気予報、計算された月齢、そして**アイドル時のスクリーンセーバーとしてスターフィールド（星空）アニメーション**を視覚的に表示します。

## 機能
-   **4連OLEDディスプレイ表示**: 128x64ピクセルのSSD1306 OLEDを4枚連結し、合計512x64ピクセルの広大な表示領域を構成します。
-   **デュアルI2Cバス**: 2つのI2Cバスを使用し、各バスに2枚ずつのOLEDを効率的に接続します。
-   **WiFi接続**: 指定されたWiFiネットワークに接続し、インターネット経由で各種情報を取得します。
-   **NTP時刻同期**: NTPサーバーから現在時刻を取得し、日付と時刻を正確に表示します。
-   **月齢表示**: 計算した月齢を、数値と月の満ち欠けを模した画像の形で表示します。
-   **天気情報表示**: OpenWeatherMap APIから取得した天気予報（今日と明日）を、天気概況・最高気温・最低気温に分けて分かりやすく表示します。
-   **秒プログレスバー**: 時刻表示画面に、秒の経過を視覚的に示すインジケータを表示します。
-   **アイドル時スクリーンセーバー (スターフィールド)**:
    *   設定時間（デフォルト10分）アイドル状態が続くと、自動で画面を消灯し、代わりに全画面で奥行き感のあるスターフィールド（星空）アニメーションを表示します。
    *   GPIO33ピンへのタッチで通常の情報表示に復帰します。
    *   フリッカー（画面のちらつき）を軽減するため、差分描画方式を採用しています。

## 表示内容の詳細

### 1枚目 (左端)
-   **日付**: `YYYY/MM/DD`形式で表示します。
-   **曜日**: `(月)` `(火)` のように表示します。
-   **月齢**: 計算された月齢の数値を表示し、その隣に月の満ち欠けを簡易的なグラフィックで描画します。

### 2枚目
-   **時刻**: `HH:MM`形式で表示します。分の切り替わり時にのみ更新され、ちらつきません。
-   **秒プログレスバー**: 時刻の下に、秒の経過（0〜59秒）を示すインジケータ（下向き三角形）が左から右へ移動します。インジケータの範囲を示すガイドラインと目盛りも表示されます。

### 3枚目
-   **今日の天気**: 「今日:」というラベルと共に、天気概況（例: 曇り）を表示します。
-   **最高気温**: 今日の最高気温を`Max:XX°C`の形式で表示します。
-   **最低気温**: 今日の最低気温を`Min:XX°C`の形式で表示します。
-   ※気温は、現在時刻から24時間以内の予報に基づきます。

### 4枚目 (右端)
-   **明日の天気**: 「明日:」というラベルと共に、天気概況を表示します。
-   **最高気温**: 明日の最高気温を`Max:XX°C`の形式で表示します。
-   **最低気温**: 明日の最低気温を`Min:XX°C`の形式で表示します。
-   ※気温は、現在時刻の24時間後〜48時間後の予報に基づきます。

### スクリーンセーバーモード時 (アイドル状態)
-   **スターフィールド**: 4枚のOLEDを連結した合計512x64ピクセルの領域全体に、奥行き感のあるスターフィールド（星空）アニメーションを表示します。
-   **表現**: 星のZ軸（奥行き）を変化させることで、画面手前に向かってくるような動きを表現します。星のサイズも奥行きに応じて変化します。
-   **フリッカー対策**: 画面全体のクリアを行わず、星の移動した部分だけを更新する差分描画により、フリッカーを抑えています。

## ハードウェア構成

### OLEDディスプレイ接続
-   128x64ピクセルのSSD1306 OLEDディスプレイ x 4枚
-   合計2つのI2Cバスを使用

### I2Cバス1
-   **SDAピン**: GPIO 21
-   **SCLピン**: GPIO 22
-   **接続OLED**:
    -   1枚目: I2Cアドレス `0x3C` (左から1番目)
    -   2枚目: I2Cアドレス `0x3D` (左から2番目)

### I2Cバス2
-   **SDAピン**: GPIO 17
-   **SCLピン**: GPIO 16
-   **接続OLED**:
    -   1枚目: I2Cアドレス `0x3C` (左から3番目)
    -   2枚目: I2Cアドレス `0x3D` (左から4番目)

## セットアップ方法

1.  **PlatformIOのインストール**:
    VS Code拡張機能またはCLI版をインストールしてください。

2.  **プロジェクトのクローンまたはダウンロード**:
    リポジトリをクローンし、VS Codeでプロジェクトフォルダを開きます。

3.  **ライブラリのインストール**:
    PlatformIOが`platformio.ini`に基づき、必要なライブラリを自動的にインストールします。

4.  **設定情報の更新**:
    `src/main.cpp`ファイルを開き、以下の定数をあなたの環境に合わせて更新してください。

    ```cpp
    const char* ssid     = "YOUR_SSID";    // あなたのWiFi SSID
    const char* password = "YOUR_PASSWORD"; // あなたのWiFiパスワード

    // --- OpenWeatherMap設定 ---
    const char* apiKey = "YOUR_OPENWEATHERMAP_API_KEY"; // あなたのOpenWeatherMap APIキー
    const char* city = "YOUR_CITY,jp"; // 例: "Tokyo,jp"

    // --- タッチ検出の閾値 ---
    // 環境やESP32の個体差により調整が必要な場合があります。
    // src/main.cpp内のSerial.print("Touch: "); Serial.println(touchValue); で値を確認し、
    // タッチしていない時よりも小さい値で、かつタッチした時の値よりも大きい値を設定してください。
    // 例: タッチなし=89, タッチあり=12 の場合、30〜80程度の値を設定。
    const int touchThreshold = 30;
    ```

5.  **ビルドと書き込み**:
    PlatformIOのビルド機能とアップロード機能を使用して、ESP32ボードにプログラムを書き込みます。

## 使用ライブラリ
-   `lovyan03/LovyanGFX`
-   `NTPClient` (時刻同期用)
-   `bblanchon/ArduinoJson` (天気情報パース用)
-   `WiFi`, `HTTPClient`, `WiFiUdp` (ESP32 Arduinoフレームワーク内蔵)
-   `random` (スターフィールドの星の配置などに使用)

## 注意事項
-   OpenWeatherMap APIキーは個人で取得し、安全に管理してください。
-   `main.cpp`では複数のフォント（`Font4`, `Font7`, `lgfxJapanGothicP_20`, `lgfxJapanGothicP_24`, `efontJA_24`など）が使用されています。これらのフォント、特に`efontJA_24`が利用可能であることを確認してください。LovyanGFXのバージョンや設定によっては、追加の定義が必要になる場合があります。
